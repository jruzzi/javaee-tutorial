type=page
status=published
title=Maintaining Client State
~~~~~~
Maintaining Client State
========================
2017-07-17T15:27:49Z

[[top]]

[width="100%",cols="50%,45%,^5%",]
|=======================================================================
|*Java Platform, Enterprise Edition The Java EE Tutorial* +
*Release 8 Java Platform, Enterprise Edition* +
E63026-01
|
|link:toc.html[image:img/toc.gif[Go To Table Of
Contents] +
Contents]
|=======================================================================

'''''

[cols="^5%,^5%,90%",]
|=======================================================================
|link:websocket005.html[image:img/leftnav.gif[Previous] +
Previous] 
|link:websocket007.html[image:img/rightnav.gif[Next] +
Next] | 
|=======================================================================


[[BABGJCAD]]

[[maintaining-client-state]]
18.6 Maintaining Client State
-----------------------------

Because the container creates an instance of the endpoint class for
every connection, you can define and use instance variables to store
client state information. In addition, the `Session.getUserProperties`
method provides a modifiable map to store user properties. For example,
the following endpoint replies to incoming text messages with the
contents of the previous message from each client:

[source,oac_no_warn]
----
@ServerEndpoint("/delayedecho")
public class DelayedEchoEndpoint {
   @OnOpen
   public void open(Session session) {
      session.getUserProperties().put("previousMsg", " ");
   }
   @OnMessage
   public void message(Session session, String msg) {
      String prev = (String) session.getUserProperties()
                                    .get("previousMsg");
      session.getUserProperties().put("previousMsg", msg);
      try {
         session.getBasicRemote().sendText(prev);
      } catch (IOException e) { ... }
   }
}
----

To store information common to all connected clients, you can use class
(static) variables; however, you are responsible for ensuring
thread-safe access to them.

'''''

[width="100%",cols="^5%,^5%,^10%,^65%,^10%,^5%",]
|====================================================================
|link:websocket005.html[image:img/leftnav.gif[Previous] +
Previous] 
|link:websocket007.html[image:img/rightnav.gif[Next] +
Next]
|
|image:img/oracle.gif[Oracle Logo]
link:cpyr.html[ +
Copyright © 2014, 2017, Oracle and/or its affiliates. All rights reserved.]
|
|link:toc.html[image:img/toc.gif[Go To Table Of
Contents] +
Contents]
|====================================================================
